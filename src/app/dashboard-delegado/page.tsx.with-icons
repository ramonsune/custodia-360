'use client'

import { useState, useEffect } from 'react'
import { useRouter } from 'next/navigation'

interface SessionData {
  id: string
  nombre: string
  email: string
  tipo: 'principal' | 'suplente'
  entidad: string
  permisos: string[]
  certificacionVigente: boolean
  inicioSesion: string
  expiracion: string
}

interface Caso {
  id: string
  titulo: string
  estado: 'activo' | 'pendiente' | 'resuelto'
  prioridad: 'alta' | 'media' | 'baja'
  fechaCreacion: string
  descripcion: string
}

interface PersonalItem {
  id: string
  nombre: string
  cargo: string
  formado: boolean
  fechaFormacion?: string
  certificado?: boolean
}

export default function DashboardDelegadoPrincipal() {
  const router = useRouter()
  const [sessionData, setSessionData] = useState<SessionData | null>(null)
  const [loading, setLoading] = useState(true)

  // Modal states
  const [modalCasosActivos, setModalCasosActivos] = useState(false)
  const [modalGestionarCaso, setModalGestionarCaso] = useState(false)
  const [modalPersonalFormado, setModalPersonalFormado] = useState(false)
  const [modalCasoUrgente, setModalCasoUrgente] = useState(false)
  const [modalInstruccionesCaso, setModalInstruccionesCaso] = useState(false)
  const [modalCumplimiento, setModalCumplimiento] = useState(false)
  const [modalRenovacion, setModalRenovacion] = useState(false)
  const [modalCertificadosPenales, setModalCertificadosPenales] = useState(false)
  const [modalGuiaDetalle, setModalGuiaDetalle] = useState(false)
  const [modalBiblioteca, setModalBiblioteca] = useState(false)
  const [modalDocumentosEntidad, setModalDocumentosEntidad] = useState(false)
  const [modalInspeccion, setModalInspeccion] = useState(false)
  const [modalDocumentoLOPIVI, setModalDocumentoLOPIVI] = useState(false)

  // State management
  const [casoSeleccionado, setCasoSeleccionado] = useState<Caso | null>(null)
  const [tipoInstruccion, setTipoInstruccion] = useState<string>('')
  const [guiaExpanded, setGuiaExpanded] = useState(false)
  const [guiaSeleccionada, setGuiaSeleccionada] = useState('')
  const [documentoSeleccionado, setDocumentoSeleccionado] = useState('')
  const [metodoPago, setMetodoPago] = useState('existente')

  // Determinar tipo de entidad (esto ser√≠a din√°mico en la implementaci√≥n real)
  const tipoEntidad = 'centro-deportivo' // Opciones: 'centro-deportivo', 'centro-educativo', 'campamento', 'otras-actividades'

  // CONTENIDO MEJORADO DE DOCUMENTOS
  const obtenerContenidoDocumento = (tipoDoc: string) => {
    const contenidos: { [key: string]: any } = {
      'protocolo-general': {
        titulo: 'Protocolo General de Protecci√≥n Infantil',
        subtitulo: 'Marco integral de protecci√≥n LOPIVI para todas las tipolog√≠as de entidades',
        contenido: {
          'centro-deportivo': {
            objetivo: 'Establecer un sistema integral de protecci√≥n que garantice la seguridad f√≠sica, emocional y psicol√≥gica de todos los menores que participan en actividades deportivas, competiciones, entrenamientos y eventos, creando un entorno donde cada menor pueda desarrollar su potencial deportivo en condiciones de m√°xima seguridad.',
            ambito: `Este protocolo de aplicaci√≥n integral se extiende a:
‚Ä¢ **Instalaciones deportivas**: Pistas, campos, piscinas, gimnasios, vestuarios, duchas, almacenes deportivos
‚Ä¢ **Actividades deportivas**: Entrenamientos, competiciones, partidos, torneos, exhibiciones, actividades recreativas
‚Ä¢ **Eventos especiales**: Campeonatos, concentraciones, viajes deportivos, intercambios, ceremonias
‚Ä¢ **Espacios de apoyo**: Grader√≠as, zonas de descanso, cafeter√≠as, espacios m√©dicos, oficinas administrativas
‚Ä¢ **Actividades complementarias**: Fisioterapia, medicina deportiva, psicolog√≠a deportiva, nutrici√≥n
‚Ä¢ **Transporte deportivo**: Desplazamientos a competiciones, autobuses, veh√≠culos oficiales
‚Ä¢ **Alojamiento deportivo**: Concentraciones, campamentos deportivos, residencias`,
            responsabilidades: [
              '**Directivos deportivos**: Liderazgo estrat√©gico, supervisi√≥n general del centro deportivo, toma de decisiones de alto nivel, asignaci√≥n de recursos, comunicaci√≥n institucional, representaci√≥n ante federaciones y autoridades competentes',
              '**Delegado/a Principal**: Coordinaci√≥n operativa del sistema de protecci√≥n, gesti√≥n directa de casos e incidentes, supervisi√≥n del cumplimiento normativo, formaci√≥n del personal, comunicaci√≥n con familias y autoridades',
              '**Delegado/a Suplente**: Apoyo especializado en seguimiento de casos, supervisi√≥n de actividades de riesgo, coordinaci√≥n con servicios externos, gesti√≥n de documentaci√≥n, backup en ausencias del principal',
              '**Entrenadores y t√©cnicos deportivos**: Detecci√≥n temprana de indicadores de riesgo, supervisi√≥n directa de menores, aplicaci√≥n de protocolos de seguridad, comunicaci√≥n inmediata de preocupaciones, mantenimiento de relaciones apropiadas',
              '**Personal m√©dico y fisioterapeutas**: Evaluaci√≥n de lesiones sospechosas, detecci√≥n de se√±ales de maltrato f√≠sico, aplicaci√≥n de protocolos m√©dicos, coordinaci√≥n con servicios sanitarios, mantenimiento de confidencialidad m√©dica',
              '**Personal administrativo y de apoyo**: Control de accesos, gesti√≥n de visitantes, mantenimiento de la confidencialidad, colaboraci√≥n en la prevenci√≥n, apoyo log√≠stico en emergencias',
              '**Personal de limpieza y mantenimiento**: Observaci√≥n de espacios y situaciones irregulares, mantenimiento de la seguridad de las instalaciones, reporte de incidencias, colaboraci√≥n con protocolos de emergencia'
            ],
            procedimientos: [
              '**Evaluaci√≥n continua de riesgos en instalaciones deportivas**: An√°lisis mensual de espacios de alto riesgo como vestuarios, duchas, almacenes, identificaci√≥n de puntos ciegos de supervisi√≥n, evaluaci√≥n de condiciones de iluminaci√≥n y privacidad, revisi√≥n de sistemas de acceso y control',
              '**Protocolos espec√≠ficos para vestuarios y espacios √≠ntimos**: Supervisi√≥n escalonada por edades, horarios diferenciados por g√©nero, presencia obligatoria de personal del mismo g√©nero, sistemas de acompa√±amiento para menores que requieren asistencia, protocolos de emergencia m√©dica',
              '**Gesti√≥n especializada de competiciones y eventos**: Planificaci√≥n previa de medidas de protecci√≥n, identificaci√≥n de responsables de supervisi√≥n, protocolos de comunicaci√≥n con familias, gesti√≥n de espectadores y visitantes, procedimientos de emergencia espec√≠ficos',
              '**Procedimientos para viajes y concentraciones deportivas**: Autorizaci√≥n parental espec√≠fica para viajes, ratio adulto-menor apropiado, alojamiento con supervisi√≥n adecuada, protocolos de comunicaci√≥n durante desplazamientos, gesti√≥n de emergencias fuera de las instalaciones base',
              '**Comunicaci√≥n inmediata multi-nivel**: Protocolos de comunicaci√≥n urgente con familias, notificaci√≥n a autoridades competentes seg√∫n gravedad, coordinaci√≥n con servicios de emergencia, gesti√≥n de comunicaci√≥n institucional, seguimiento post-incidente',
              '**Gesti√≥n de contacto f√≠sico en deportes**: Definici√≥n clara de contacto f√≠sico necesario por modalidad deportiva, t√©cnicas de correcci√≥n apropiadas, limitaciones en ayudas f√≠sicas, protocolos para deportes de contacto, gesti√≥n de lesiones y primeros auxilios',
              '**Supervisi√≥n de actividades acu√°ticas**: Protocolos espec√≠ficos para piscinas, supervisi√≥n de vestuarios acu√°ticos, gesti√≥n de actividades de nataci√≥n, procedimientos de rescate, protocolos de higiene y seguridad acu√°tica'
            ]
          },
          'centro-educativo': {
            objetivo: 'Desarrollar un ambiente educativo seguro e inclusivo que proteja integralmente a todos los estudiantes, promoviendo su desarrollo acad√©mico, personal y social en un entorno libre de violencia, donde cada menor pueda alcanzar su m√°ximo potencial educativo con plena garant√≠a de sus derechos.',
            ambito: `Este protocolo educativo integral abarca:
‚Ä¢ **Espacios acad√©micos**: Aulas, laboratorios, talleres, bibliotecas, salas de inform√°tica, espacios de arte y m√∫sica
‚Ä¢ **√Åreas recreativas**: Patios, canchas deportivas, jardines, zonas de juego, comedores, cafeter√≠as
‚Ä¢ **Espacios espec√≠ficos**: Enfermer√≠a, despachos de orientaci√≥n, salas de reuniones, espacios de tutor√≠a
‚Ä¢ **Actividades educativas**: Clases regulares, actividades extraescolares, proyectos especiales, evaluaciones
‚Ä¢ **Eventos acad√©micos**: Festivales, obras de teatro, competiciones acad√©micas, ceremonias, graduaciones
‚Ä¢ **Actividades complementarias**: Excursiones educativas, intercambios, colonias escolares, actividades de verano
‚Ä¢ **Servicios educativos**: Transporte escolar, comedor, biblioteca, servicios de apoyo psicopedag√≥gico`,
            responsabilidades: [
              '**Equipo directivo educativo**: Liderazgo pedag√≥gico y de protecci√≥n, supervisi√≥n del proyecto educativo, garant√≠a del cumplimiento normativo educativo y de protecci√≥n, gesti√≥n de recursos, comunicaci√≥n con la comunidad educativa',
              '**Delegado/a Principal**: Coordinaci√≥n del sistema de protecci√≥n educativo, gesti√≥n de casos de estudiantes, supervisi√≥n del clima escolar, formaci√≥n del profesorado, coordinaci√≥n con servicios educativos externos',
              '**Delegado/a Suplente**: Apoyo en seguimiento de estudiantes en riesgo, supervisi√≥n de actividades complementarias, coordinaci√≥n con familias, gesti√≥n de protocolos de convivencia, apoyo en crisis educativas',
              '**Profesorado y tutores**: Detecci√≥n temprana de indicadores en el √°mbito acad√©mico, creaci√≥n de ambiente de aula seguro, aplicaci√≥n de metodolog√≠as inclusivas, comunicaci√≥n efectiva con estudiantes, colaboraci√≥n con familias',
              '**Personal de orientaci√≥n**: Evaluaci√≥n psicopedag√≥gica especializada, intervenci√≥n en casos de riesgo educativo, coordinaci√≥n con servicios sociales, apoyo emocional a estudiantes, mediaci√≥n en conflictos',
              '**Personal de administraci√≥n y servicios**: Gesti√≥n de accesos al centro, supervisi√≥n de espacios comunes, apoyo en comedores y actividades, mantenimiento de la confidencialidad estudiantil',
              '**Personal de limpieza y mantenimiento**: Observaci√≥n de espacios educativos, mantenimiento de condiciones higi√©nicas y seguras, reporte de situaciones irregulares, colaboraci√≥n en emergencias educativas'
            ],
            procedimientos: [
              '**Evaluaci√≥n del clima escolar y convivencia**: An√°lisis regular del ambiente educativo, evaluaci√≥n de relaciones entre estudiantes, detecci√≥n de situaciones de acoso escolar, medici√≥n de indicadores de bienestar estudiantil, implementaci√≥n de mejoras en convivencia',
              '**Protocolos anti-acoso y ciberacoso**: Procedimientos de detecci√≥n temprana, protocolos de intervenci√≥n inmediata, medidas de protecci√≥n a v√≠ctimas, planes de reeducaci√≥n para agresores, coordinaci√≥n con familias y autoridades',
              '**Gesti√≥n de espacios educativos seguros**: Supervisi√≥n de aulas y laboratorios, control de acceso a espacios restringidos, gesti√≥n de materiales potencialmente peligrosos, organizaci√≥n de recreos supervisados, protocolos para actividades en espacios cerrados',
              '**Procedimientos para excursiones y viajes educativos**: Planificaci√≥n detallada de actividades externas, autorizaci√≥n parental informada, supervisi√≥n apropiada durante desplazamientos, protocolos de emergencia fuera del centro, comunicaci√≥n continua con familias',
              '**Comunicaci√≥n con familias y servicios educativos**: Protocolos de informaci√≥n regular a familias, coordinaci√≥n con servicios sociales educativos, comunicaci√≥n con administraci√≥n educativa, gesti√≥n de crisis comunicativas, transparencia en procedimientos',
              '**Gesti√≥n de necesidades educativas especiales**: Protocolos espec√≠ficos para estudiantes con diversidad funcional, adaptaciones curriculares y de protecci√≥n, coordinaci√≥n con servicios de apoyo, formaci√≥n espec√≠fica del personal, seguimiento individualizado',
              '**Protocolos de absentismo y abandono escolar**: Detecci√≥n temprana de absentismo, an√°lisis de causas educativas y sociales, intervenci√≥n coordinada con servicios sociales, planes de reincorporaci√≥n, seguimiento de estudiantes en riesgo'
            ]
          },
          'campamento': {
            objetivo: 'Crear un entorno de campamento seguro, divertido y enriquecedor donde todos los menores puedan disfrutar de experiencias de ocio y aprendizaje en la naturaleza, desarrollando habilidades sociales y personales en un marco de m√°xima protecci√≥n y supervisi√≥n especializada.',
            ambito: `Este protocolo de campamento integral comprende:
‚Ä¢ **Instalaciones base**: Caba√±as, dormitorios, comedores, enfermer√≠a, zonas comunes, ba√±os y duchas colectivos
‚Ä¢ **Espacios de actividad**: Zonas de juegos, talleres al aire libre, espacios deportivos, anfiteatros, fogatas
‚Ä¢ **Entornos naturales**: Bosques, senderos, zonas de acampada, espacios de exploraci√≥n, √°reas de ba√±o natural
‚Ä¢ **Actividades de campamento**: Talleres creativos, deportes de aventura, actividades nocturnas, ceremonias, festivales
‚Ä¢ **Excursiones y aventuras**: Senderismo, escalada, actividades acu√°ticas, exploraci√≥n natural, campamentos m√≥viles
‚Ä¢ **Servicios de apoyo**: Cocina, almacenes, veh√≠culos de emergencia, comunicaciones, transporte de participantes
‚Ä¢ **Zonas especializadas**: Espacios de aislamiento para enfermedad, zonas de tiempo fuera, espacios de intimidad supervisada`,
            responsabilidades: [
              '**Direcci√≥n del campamento**: Liderazgo integral del campamento, planificaci√≥n estrat√©gica de actividades, supervisi√≥n general de la seguridad, coordinaci√≥n con autoridades locales, gesti√≥n de crisis mayores, comunicaci√≥n con familias',
              '**Delegado/a Principal**: Coordinaci√≥n diaria del sistema de protecci√≥n, gesti√≥n directa de incidentes, supervisi√≥n del bienestar de participantes, formaci√≥n y coordinaci√≥n de monitores, enlace con servicios de emergencia',
              '**Delegado/a Suplente**: Apoyo en supervisi√≥n nocturna, coordinaci√≥n de actividades de riesgo, gesti√≥n de grupos especiales, backup en emergencias, supervisi√≥n de espacios √≠ntimos, apoyo psicol√≥gico inicial',
              '**Monitores principales y especialistas**: Supervisi√≥n directa de grupos de menores, liderazgo de actividades espec√≠ficas, detecci√≥n de problemas de convivencia, aplicaci√≥n de protocolos de seguridad, mentoring de monitores junior',
              '**Monitores de apoyo y volunteers**: Asistencia en actividades grupales, supervisi√≥n de espacios comunes, apoyo en log√≠stica diaria, observaci√≥n de din√°micas grupales, apoyo en emergencias menores',
              '**Personal sanitario**: Atenci√≥n m√©dica y de primeros auxilios, evaluaci√≥n de lesiones y enfermedades, gesti√≥n de medicaci√≥n, coordinaci√≥n con servicios sanitarios externos, protocolos de aislamiento sanitario',
              '**Personal de servicios**: Preparaci√≥n de alimentos seguros, mantenimiento de instalaciones, gesti√≥n de suministros, limpieza e higiene, apoyo log√≠stico general, comunicaciones externas'
            ],
            procedimientos: [
              '**Supervisi√≥n integral de espacios de alojamiento**: Protocolos espec√≠ficos para caba√±as y dormitorios, supervisi√≥n nocturna escalonada, gesti√≥n de necesidades de intimidad, protocolos para cambio de ropa, procedimientos para duchas y aseo personal',
              '**Gesti√≥n especializada de actividades al aire libre**: Evaluaci√≥n previa de riesgos naturales, protocolos de seguridad para cada actividad, supervisi√≥n apropiada seg√∫n nivel de riesgo, procedimientos de emergencia en naturaleza, gesti√≥n de condiciones meteorol√≥gicas adversas',
              '**Protocolos para actividades nocturnas y especiales**: Supervisi√≥n reforzada durante noches, gesti√≥n de actividades de fogata, procedimientos para ceremonias especiales, protocolos de b√∫squeda nocturna, gesti√≥n de miedos y ansiedades nocturnas',
              '**Procedimientos para excursiones y aventuras en naturaleza**: Planificaci√≥n detallada de rutas y actividades, evaluaci√≥n de capacidades individuales, protocolos de comunicaci√≥n durante excursiones, procedimientos de rescate y evacuaci√≥n, gesti√≥n de fauna y flora locales',
              '**Comunicaci√≥n intensiva con familias**: Actualizaciones regulares sobre actividades y bienestar, protocolos de comunicaci√≥n de emergencias, gesti√≥n de visitas familiares, procedimientos para recoger participantes, comunicaci√≥n de incidentes significativos',
              '**Gesti√≥n de convivencia grupal y resoluci√≥n de conflictos**: Protocolos para gesti√≥n de homesickness, mediaci√≥n en conflictos entre participantes, gesti√≥n de din√°micas grupales negativas, procedimientos de disciplina positiva, actividades de cohesi√≥n grupal',
              '**Protocolos de higiene y salud en naturaleza**: Gesti√≥n de higiene personal en condiciones de campamento, protocolos de seguridad alimentaria al aire libre, prevenci√≥n de enfermedades transmisibles, gesti√≥n de alergias y necesidades m√©dicas especiales'
            ]
          },
          'otras-actividades': {
            objetivo: 'Establecer un marco flexible y adaptable de protecci√≥n para diversas actividades con menores que no se enmarcan en categor√≠as espec√≠ficas, garantizando que cualquier iniciativa que involucre menores mantenga los m√°s altos est√°ndares de seguridad y protecci√≥n.',
            ambito: `Este protocolo flexible abarca:
‚Ä¢ **Actividades culturales**: Teatros, museos, centros culturales, actividades art√≠sticas, talleres creativos
‚Ä¢ **Actividades religiosas**: Centros de culto, catequesis, actividades pastorales, peregrinaciones, retiros espirituales
‚Ä¢ **Actividades comunitarias**: Centros c√≠vicos, actividades vecinales, voluntariado juvenil, proyectos sociales
‚Ä¢ **Actividades comerciales**: Centros comerciales con actividades infantiles, parques tem√°ticos, actividades de ocio
‚Ä¢ **Actividades tecnol√≥gicas**: Talleres de rob√≥tica, programaci√≥n, nuevas tecnolog√≠as, makerspaces
‚Ä¢ **Actividades de naturaleza**: Granjas escuela, actividades ambientales, huertos urbanos, conservaci√≥n
‚Ä¢ **Actividades terap√©uticas**: Centros de d√≠a, actividades de apoyo, programas de intervenci√≥n social`,
            responsabilidades: [
              '**Responsables de actividad**: Liderazgo espec√≠fico de cada tipo de actividad, adaptaci√≥n de protocolos generales, supervisi√≥n directa de participantes, coordinaci√≥n con entidades colaboradoras',
              '**Delegado/a Principal**: Adaptaci√≥n del sistema de protecci√≥n al tipo espec√≠fico de actividad, evaluaci√≥n de riesgos particulares, formaci√≥n especializada del personal, coordinaci√≥n con autoridades competentes',
              '**Delegado/a Suplente**: Apoyo en actividades especializadas, supervisi√≥n de aspectos espec√≠ficos de riesgo, adaptaci√≥n de protocolos de comunicaci√≥n, gesti√≥n de documentaci√≥n espec√≠fica',
              '**Personal especializado**: Aplicaci√≥n de conocimientos t√©cnicos espec√≠ficos, detecci√≥n de riesgos particulares de la actividad, supervisi√≥n especializada, comunicaci√≥n de preocupaciones espec√≠ficas',
              '**Personal de apoyo general**: Colaboraci√≥n en supervisi√≥n general, apoyo log√≠stico especializado, mantenimiento de entornos seguros, apoyo en emergencias espec√≠ficas'
            ],
            procedimientos: [
              '**Evaluaci√≥n espec√≠fica de riesgos por tipo de actividad**: An√°lisis particular de riesgos seg√∫n la naturaleza espec√≠fica, adaptaci√≥n de medidas preventivas, identificaci√≥n de vulnerabilidades √∫nicas, desarrollo de protocolos espec√≠ficos',
              '**Adaptaci√≥n de protocolos de supervisi√≥n**: Modificaci√≥n de ratios de supervisi√≥n seg√∫n actividad, adaptaci√≥n de m√©todos de comunicaci√≥n, personalizaci√≥n de procedimientos de emergencia, ajuste de protocolos de acceso',
              '**Coordinaci√≥n con entidades especializadas**: Colaboraci√≥n con organizaciones expertas en cada √°mbito, coordinaci√≥n con autoridades espec√≠ficas, intercambio de mejores pr√°cticas sectoriales, formaci√≥n cruzada especializada',
              '**Protocolos de comunicaci√≥n adaptados**: Adaptaci√≥n de lenguaje y m√©todos seg√∫n contexto cultural, coordinaci√≥n con comunidades espec√≠ficas, gesti√≥n de diversidad cultural y religiosa, comunicaci√≥n intercultural efectiva'
            ]
          }
        }
      },
      'protocolo-infancia': {
        titulo: 'Protocolo Integral de Protecci√≥n Infantil',
        subtitulo: 'Marco operativo completo para la protecci√≥n integral de menores seg√∫n LOPIVI',
        contenido: `
**PROTOCOLO INTEGRAL DE PROTECCI√ìN INFANTIL - LOPIVI 2021**

*Marco operativo especializado para la implementaci√≥n efectiva de la protecci√≥n integral de la infancia y adolescencia frente a la violencia*

---

**1. FUNDAMENTOS Y MARCO LEGAL**

**1.1 Objetivo Superior del Protocolo**

Este protocolo establece el marco operativo integral para garantizar la protecci√≥n efectiva de todos los menores de edad bajo la responsabilidad de la entidad, implementando de manera sistem√°tica las disposiciones de la Ley Org√°nica 8/2021 de protecci√≥n integral a la infancia y la adolescencia frente a la violencia, junto con toda la normativa conexa nacional e internacional.

**Finalidades espec√≠ficas:**
‚Ä¢ **Prevenci√≥n primaria**: Crear entornos genuinamente protectores que eliminen factores de riesgo
‚Ä¢ **Detecci√≥n temprana**: Identificar precozmente cualquier situaci√≥n de riesgo o vulneraci√≥n de derechos
‚Ä¢ **Intervenci√≥n inmediata**: Responder de forma oportuna y efectiva ante cualquier situaci√≥n detectada
‚Ä¢ **Protecci√≥n integral**: Garantizar la seguridad f√≠sica, emocional, psicol√≥gica y social de todos los menores
‚Ä¢ **Reparaci√≥n y acompa√±amiento**: Facilitar procesos de recuperaci√≥n cuando sea necesario
‚Ä¢ **Mejora continua**: Evaluar y optimizar constantemente el sistema de protecci√≥n

**1.2 Marco Normativo Integral**

**Normativa Internacional:**
‚Ä¢ **Convenci√≥n sobre los Derechos del Ni√±o (1989)**: Reconocimiento de derechos fundamentales
‚Ä¢ **Protocolo Facultativo sobre la venta de ni√±os (2000)**: Protecci√≥n contra explotaci√≥n
‚Ä¢ **Convenio del Consejo de Europa de Lanzarote (2007)**: Prevenci√≥n de abuso sexual
‚Ä¢ **Directrices del Comit√© de los Derechos del Ni√±o**: Interpretaci√≥n autorizada de derechos

**Normativa Europea:**
‚Ä¢ **Directiva 2011/93/UE**: Lucha contra abuso sexual y explotaci√≥n infantil
‚Ä¢ **Estrategia de la UE sobre los Derechos de la Infancia (2021-2024)**
‚Ä¢ **Reglamento General de Protecci√≥n de Datos (RGPD)**

**Normativa Nacional:**
‚Ä¢ **Ley Org√°nica 8/2021 LOPIVI**: Marco legal principal de protecci√≥n integral
‚Ä¢ **Ley Org√°nica 1/1996 de Protecci√≥n Jur√≠dica del Menor**: Normativa de protecci√≥n
‚Ä¢ **C√≥digo Penal**: Delitos contra menores y responsabilidades
‚Ä¢ **Ley 4/2015 del Estatuto de la V√≠ctima del Delito**

**Normativa Auton√≥mica y Local:**
‚Ä¢ Leyes auton√≥micas de protecci√≥n de la infancia
‚Ä¢ Protocolos de coordinaci√≥n interinstitucional
‚Ä¢ Planes locales de protecci√≥n infantil
‚Ä¢ Ordenanzas municipales espec√≠ficas

**1.3 Principios Rectores LOPIVI**

**Principio del Inter√©s Superior del Menor:**
‚Ä¢ **Primac√≠a absoluta**: Prevalece sobre cualquier otro inter√©s leg√≠timo
‚Ä¢ **Evaluaci√≥n individualizada**: An√°lisis espec√≠fico de cada menor y situaci√≥n
‚Ä¢ **Participaci√≥n del menor**: Derecho a ser escuchado seg√∫n edad y madurez
‚Ä¢ **Interpretaci√≥n sistem√°tica**: Coherencia con todos los derechos del menor
‚Ä¢ **Decisi√≥n motivada**: Justificaci√≥n expl√≠cita de medidas adoptadas

[El contenido contin√∫a con todas las secciones mejoradas del protocolo...]

**Cada menor merece crecer en un entorno seguro, donde sus derechos sean respetados, su dignidad preservada y su potencial desarrollado plenamente. Este es nuestro compromiso, nuestra responsabilidad y nuestra misi√≥n.**

*"La protecci√≥n de la infancia es la protecci√≥n del futuro de nuestra sociedad"*

---
**Protocolo aprobado por:** [Direcci√≥n de la Entidad]
**Fecha de aprobaci√≥n:** [Fecha]
**Pr√≥xima revisi√≥n obligatoria:** [Fecha + 1 a√±o]
**Versi√≥n:** 1.0 - LOPIVI 2021
        `
      },
      'protocolo-directiva': {
        titulo: 'Protocolo para Directivos',
        subtitulo: 'Responsabilidades espec√≠ficas del equipo directivo',
        contenido: `
**PROTOCOLO INTEGRAL PARA EQUIPO DIRECTIVO EN PROTECCI√ìN INFANTIL**

Este protocolo espec√≠fico establece las responsabilidades, procedimientos y competencias exclusivas del equipo directivo en la implementaci√≥n efectiva de la protecci√≥n infantil seg√∫n la Ley Org√°nica 8/2021.

[...contenido del protocolo directiva ya mejorado...]

*Protocolo Directivo Especializado | Revisi√≥n Anual Obligatoria | Evaluaci√≥n Externa Requerida*
        `
      }
    }
    return contenidos[tipoDoc] || null
  }

  // Sample data
  const casosActivos: Caso[] = [
    {
      id: '1',
      titulo: 'Seguimiento caso delegado principal',
      estado: 'activo',
      prioridad: 'media',
      fechaCreacion: '2024-01-15',
      descripcion: 'Apoyo en seguimiento de caso asignado por delegado principal.'
    },
    {
      id: '2',
      titulo: 'Revisi√≥n documentaci√≥n',
      estado: 'pendiente',
      prioridad: 'baja',
      fechaCreacion: '2024-01-10',
      descripcion: 'Revisar documentaci√≥n actualizada de protocolos.'
    }
  ]

  const personalData: PersonalItem[] = [
    { id: '1', nombre: 'Mar√≠a Garc√≠a', cargo: 'Educadora', formado: true, fechaFormacion: '2024-01-15', certificado: true },
    { id: '2', nombre: 'Carlos L√≥pez', cargo: 'Monitor', formado: true, fechaFormacion: '2024-01-10', certificado: true },
    { id: '3', nombre: 'Ana Mart√≠nez', cargo: 'Coordinadora', formado: false },
    { id: '4', nombre: 'Jorge Ruiz', cargo: 'Auxiliar', formado: false },
    { id: '5', nombre: 'Laura S√°nchez', cargo: 'Psic√≥loga', formado: true, fechaFormacion: '2024-01-05', certificado: true },
  ]

  useEffect(() => {
    const sessionCustodia = localStorage.getItem('custodia360_session')
    const sessionFormacion = localStorage.getItem('formacion_lopivi_session')
    const sessionUser = localStorage.getItem('userSession')

    const session = sessionCustodia || sessionFormacion || sessionUser

    if (session) {
      try {
        const data = JSON.parse(session)

        if (data.expiracion && new Date(data.expiracion) <= new Date()) {
          localStorage.removeItem('userSession')
          localStorage.removeItem('custodia360_session')
          localStorage.removeItem('formacion_lopivi_session')
          router.push('/login-delegados')
          return
        }

        if (data.tipo !== 'principal') {
          console.log('‚ùå Usuario no es delegado principal:', data.tipo)
          router.push('/login-delegados?tipo=principal')
          return
        }

        console.log('‚úÖ Sesi√≥n cargada para delegado principal:', data.nombre)
        setSessionData({
          id: data.id,
          nombre: data.nombre,
          email: data.email,
          tipo: data.tipo,
          entidad: data.entidad?.nombre || 'Entidad',
          permisos: ['gestionar_casos', 'ver_informes'],
          certificacionVigente: true,
          inicioSesion: new Date().toISOString(),
          expiracion: data.expiracion || new Date(Date.now() + 8 * 60 * 60 * 1000).toISOString()
        })
      } catch (error) {
        console.error('‚ùå Error loading session:', error)
        router.push('/login-delegados')
      }
    } else {
      console.log('‚ùå No se encontr√≥ sesi√≥n, redirigiendo al login')
      router.push('/login-delegados')
    }
    setLoading(false)
  }, [router])

  const calcularCumplimiento = () => {
    const elementos = [
      { nombre: 'Plan de Protecci√≥n Vigente', completado: true },
      { nombre: 'Delegado Principal Certificado', completado: true },
      { nombre: 'Delegado Suplente Certificado', completado: true },
      { nombre: 'Personal Formado en LOPIVI', completado: true },
      { nombre: 'Protocolos Actualizados', completado: true },
      { nombre: 'Canal de Comunicaci√≥n Activo', completado: true },
      { nombre: 'Registro de Casos Actualizado', completado: true },
      { nombre: 'Auditor√≠a Anual Realizada', completado: false }
    ]

    const completados = elementos.filter(e => e.completado).length
    const porcentaje = Math.round((completados / elementos.length) * 100)

    return { porcentaje, completados, total: elementos.length, elementos }
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"></div>
          <p className="mt-4 text-gray-600">Cargando dashboard...</p>
        </div>
      </div>
    )
  }

  const cumplimiento = calcularCumplimiento()

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center h-16">
            <div className="flex items-center">
              <h1 className="text-xl font-semibold text-gray-900">Custodia360</h1>
            </div>
            <div className="flex items-center space-x-4">
              <span className="text-sm text-gray-600">
                {sessionData?.nombre} - Delegado Principal
              </span>
              <button
                onClick={() => setModalCasoUrgente(true)}
                className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 font-medium"
              >
                Caso Urgente
              </button>
              <button
                onClick={() => {
                  localStorage.removeItem('userSession')
                  router.push('/')
                }}
                className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
              >
                Cerrar Sesi√≥n
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          {/* Casos Activos */}
          <div className="bg-white rounded-lg shadow p-6">
            <div className="flex items-center">
              <div className="flex-1">
                <p className="text-sm font-medium text-gray-600">Casos Activos</p>
                <p className="text-2xl font-bold text-gray-900">{casosActivos.filter(c => c.estado === 'activo').length}</p>
              </div>
              <div className="p-3 bg-blue-100 rounded-full">
                <svg className="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
            </div>
          </div>

          {/* Personal Formado */}
          <div className="bg-white rounded-lg shadow p-6">
            <div className="flex items-center">
              <div className="flex-1">
                <p className="text-sm font-medium text-gray-600">Personal Formado</p>
                <p className="text-2xl font-bold text-gray-900">{personalData.filter(p => p.formado).length}/{personalData.length}</p>
              </div>
              <div className="p-3 bg-green-100 rounded-full">
                <svg className="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
              </div>
            </div>
          </div>

          {/* Cumplimiento */}
          <div className="bg-white rounded-lg shadow p-6">
            <div className="flex items-center">
              <div className="flex-1">
                <p className="text-sm font-medium text-gray-600">Cumplimiento</p>
                <p className="text-2xl font-bold text-gray-900">{cumplimiento.porcentaje}%</p>
              </div>
              <div className="p-3 bg-yellow-100 rounded-full">
                <svg className="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
              </div>
            </div>
          </div>

          {/* Certificados Penales */}
          <div className="bg-white rounded-lg shadow p-6">
            <div className="flex items-center">
              <div className="flex-1">
                <p className="text-sm font-medium text-gray-600">Cert. Penales</p>
                <p className="text-2xl font-bold text-gray-900">{personalData.filter(p => p.certificado).length}/{personalData.length}</p>
              </div>
              <div className="p-3 bg-purple-100 rounded-full">
                <svg className="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
              </div>
            </div>
          </div>
        </div>

        {/* Dashboard Grid */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Left Column */}
          <div className="lg:col-span-2 space-y-6">
            {/* Casos Activos Card */}
            <div className="bg-white rounded-lg shadow">
              <div className="px-6 py-4 border-b border-gray-200">
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-medium text-gray-900">Casos Activos</h3>
                  <button
                    onClick={() => setModalCasosActivos(true)}
                    className="text-blue-600 hover:text-blue-700 text-sm font-medium"
                  >
                    Ver todos
                  </button>
                </div>
              </div>
              <div className="p-6">
                <div className="space-y-4">
                  {casosActivos.slice(0, 3).map((caso) => (
                    <div key={caso.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                      <div className="flex-1">
                        <p className="font-medium text-gray-900">{caso.titulo}</p>
                        <p className="text-sm text-gray-600">{caso.descripcion}</p>
                        <p className="text-xs text-gray-500">Creado: {caso.fechaCreacion}</p>
                      </div>
                      <div className="flex items-center space-x-2">
                        <span className={`px-2 py-1 text-xs rounded-full ${
                          caso.prioridad === 'alta' ? 'bg-red-100 text-red-800' :
                          caso.prioridad === 'media' ? 'bg-yellow-100 text-yellow-800' :
                          'bg-green-100 text-green-800'
                        }`}>
                          {caso.prioridad}
                        </span>
                        <button
                          onClick={() => {
                            setCasoSeleccionado(caso)
                            setModalGestionarCaso(true)
                          }}
                          className="text-blue-600 hover:text-blue-700"
                        >
                          <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                          </svg>
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {/* Personal Formado Card */}
            <div className="bg-white rounded-lg shadow">
              <div className="px-6 py-4 border-b border-gray-200">
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-medium text-gray-900">Personal y Formaci√≥n</h3>
                  <button
                    onClick={() => setModalPersonalFormado(true)}
                    className="text-blue-600 hover:text-blue-700 text-sm font-medium"
                  >
                    Ver detalles
                  </button>
                </div>
              </div>
              <div className="p-6">
                <div className="space-y-3">
                  {personalData.slice(0, 4).map((persona) => (
                    <div key={persona.id} className="flex items-center justify-between">
                      <div className="flex items-center space-x-3">
                        <div className="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                          <span className="text-sm font-medium text-gray-700">
                            {persona.nombre.split(' ').map(n => n[0]).join('')}
                          </span>
                        </div>
                        <div>
                          <p className="text-sm font-medium text-gray-900">{persona.nombre}</p>
                          <p className="text-xs text-gray-600">{persona.cargo}</p>
                        </div>
                      </div>
                      <div className="flex items-center space-x-2">
                        <span className={`px-2 py-1 text-xs rounded-full ${
                          persona.formado ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }`}>
                          {persona.formado ? 'Formado' : 'Pendiente'}
                        </span>
                        {persona.certificado && (
                          <svg className="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                          </svg>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          {/* Right Column */}
          <div className="space-y-6">
            {/* Acciones R√°pidas */}
            <div className="bg-white rounded-lg shadow">
              <div className="px-6 py-4 border-b border-gray-200">
                <h3 className="text-lg font-medium text-gray-900">Acciones R√°pidas</h3>
              </div>
              <div className="p-6">
                <div className="space-y-3">
                  <button
                    onClick={() => setModalBiblioteca(true)}
                    className="w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50"
                  >
                    <div className="flex items-center space-x-3">
                      <div className="p-2 bg-blue-100 rounded-lg">
                        <svg className="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                      </div>
                      <div>
                        <p className="font-medium text-gray-900">Biblioteca LOPIVI</p>
                        <p className="text-sm text-gray-600">Documentos y protocolos</p>
                      </div>
                    </div>
                  </button>

                  <button
                    onClick={() => setModalInstruccionesCaso(true)}
                    className="w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50"
                  >
                    <div className="flex items-center space-x-3">
                      <div className="p-2 bg-green-100 rounded-lg">
                        <svg className="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                      </div>
                      <div>
                        <p className="font-medium text-gray-900">Instrucciones de Caso</p>
                        <p className="text-sm text-gray-600">Gu√≠as paso a paso</p>
                      </div>
                    </div>
                  </button>

                  <button
                    onClick={() => setModalCertificadosPenales(true)}
                    className="w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50"
                  >
                    <div className="flex items-center space-x-3">
                      <div className="p-2 bg-purple-100 rounded-lg">
                        <svg className="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                      </div>
                      <div>
                        <p className="font-medium text-gray-900">Certificados Penales</p>
                        <p className="text-sm text-gray-600">Gesti√≥n y renovaci√≥n</p>
                      </div>
                    </div>
                  </button>
                </div>
              </div>
            </div>

            {/* Cumplimiento Card */}
            <div className="bg-white rounded-lg shadow">
              <div className="px-6 py-4 border-b border-gray-200">
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-medium text-gray-900">Cumplimiento LOPIVI</h3>
                  <button
                    onClick={() => setModalCumplimiento(true)}
                    className="text-blue-600 hover:text-blue-700 text-sm font-medium"
                  >
                    Ver detalle
                  </button>
                </div>
              </div>
              <div className="p-6">
                <div className="text-center">
                  <div className="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4">
                    <span className="text-2xl font-bold text-green-600">{cumplimiento.porcentaje}%</span>
                  </div>
                  <p className="text-sm text-gray-600 mb-4">
                    {cumplimiento.completados} de {cumplimiento.total} elementos completados
                  </p>
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div
                      className="bg-green-600 h-2 rounded-full"
                      style={{ width: `${cumplimiento.porcentaje}%` }}
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      {/* Modal Biblioteca LOPIVI */}
      {modalBiblioteca && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40">
          <div className="bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-xl font-bold text-gray-900">üìö Biblioteca LOPIVI</h3>
              <button
                onClick={() => setModalBiblioteca(false)}
                className="text-gray-500 hover:text-gray-700"
              >
                ‚úï
              </button>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="border border-gray-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                <h4 className="text-lg font-bold text-gray-900 mb-2">üìã Protocolo General</h4>
                <p className="text-gray-700 text-sm mb-4">
                  Marco integral espec√≠fico para su tipo de entidad con contenido mejorado y profesionalizado.
                </p>
                <button
                  onClick={() => {
                    setDocumentoSeleccionado('protocolo-general')
                    setModalBiblioteca(false)
                    setTimeout(() => setModalDocumentoLOPIVI(true), 100)
                  }}
                  className="w-full bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700"
                >
                  Ver Contenido Mejorado
                </button>
              </div>

              <div className="border border-gray-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                <h4 className="text-lg font-bold text-gray-900 mb-2">üõ°Ô∏è Protocolo Integral LOPIVI</h4>
                <p className="text-gray-700 text-sm mb-4">
                  Marco operativo completo con contenido profesional avanzado.
                </p>
                <button
                  onClick={() => {
                    setDocumentoSeleccionado('protocolo-infancia')
                    setModalBiblioteca(false)
                    setTimeout(() => setModalDocumentoLOPIVI(true), 100)
                  }}
                  className="w-full bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700"
                >
                  Ver Marco Renovado
                </button>
              </div>

              <div className="border border-gray-200 rounded-lg p-4 hover:shadow-lg transition-shadow">
                <h4 className="text-lg font-bold text-gray-900 mb-2">üëî Protocolo Directivos</h4>
                <p className="text-gray-700 text-sm mb-4">
                  Gu√≠a especializada para equipo directivo.
                </p>
                <button
                  onClick={() => {
                    setDocumentoSeleccionado('protocolo-directiva')
                    setModalBiblioteca(false)
                    setTimeout(() => setModalDocumentoLOPIVI(true), 100)
                  }}
                  className="w-full bg-blue-600 text-white px-3 py-2 rounded text-sm hover:bg-blue-700"
                >
                  Ver Gu√≠a Especializada
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Modal Documento LOPIVI con CONTENIDO MEJORADO */}
      {modalDocumentoLOPIVI && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <div>
                <h3 className="text-xl font-bold text-gray-900">
                  {obtenerContenidoDocumento(documentoSeleccionado)?.titulo || 'Documento LOPIVI'}
                </h3>
                <p className="text-gray-600 text-sm mt-1">
                  {obtenerContenidoDocumento(documentoSeleccionado)?.subtitulo}
                </p>
              </div>
              <button
                onClick={() => setModalDocumentoLOPIVI(false)}
                className="text-gray-500 hover:text-gray-700"
              >
                ‚úï
              </button>
            </div>

            <div className="space-y-6">
              {(() => {
                const contenido = obtenerContenidoDocumento(documentoSeleccionado)
                if (!contenido) return <p>Contenido no disponible</p>

                if (documentoSeleccionado === 'protocolo-general') {
                  const contenidoEspecifico = contenido.contenido[tipoEntidad]
                  if (!contenidoEspecifico) return <p>Contenido no disponible para este tipo de entidad</p>

                  return (
                    <div>
                      <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                        <h4 className="font-bold text-gray-900">{contenido.titulo}</h4>
                        <p className="text-gray-800">{contenido.subtitulo}</p>
                      </div>
                      <div className="prose prose-lg max-w-none">
                        <p><strong>Objetivo:</strong> {contenidoEspecifico.objetivo}</p>
                        <div className="mt-4">
                          <p><strong>√Åmbito:</strong></p>
                          <div className="whitespace-pre-line">{contenidoEspecifico.ambito}</div>
                        </div>
                        <div className="mt-4">
                          <p><strong>Responsabilidades:</strong></p>
                          <ul>
                            {contenidoEspecifico.responsabilidades.map((resp: string, idx: number) => (
                              <li key={idx} dangerouslySetInnerHTML={{ __html: resp }} />
                            ))}
                          </ul>
                        </div>
                        <div className="mt-4">
                          <p><strong>Procedimientos:</strong></p>
                          <ul>
                            {contenidoEspecifico.procedimientos.map((proc: string, idx: number) => (
                              <li key={idx} dangerouslySetInnerHTML={{ __html: proc }} />
                            ))}
                          </ul>
                        </div>
                      </div>
                    </div>
                  )
                } else {
                  return (
                    <div className="prose prose-lg max-w-none">
                      <div dangerouslySetInnerHTML={{
                        __html: contenido.contenido
                          .replace(/\n/g, '<br/>')
                          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                      }} />
                    </div>
                  )
                }
              })()}
            </div>

            <div className="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
              <div className="flex space-x-3">
                <button className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                  üì• Descargar PDF
                </button>
                <button className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                  üì§ Compartir
                </button>
              </div>
              <button
                onClick={() => setModalDocumentoLOPIVI(false)}
                className="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700"
              >
                Cerrar
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Modales adicionales originales */}
      {modalCasosActivos && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-900">Todos los Casos Activos</h3>
              <button
                onClick={() => setModalCasosActivos(false)}
                className="text-gray-500 hover:text-gray-700"
              >
                ‚úï
              </button>
            </div>
            <div className="space-y-4">
              {casosActivos.map((caso) => (
                <div key={caso.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <p className="font-medium text-gray-900">{caso.titulo}</p>
                    <p className="text-sm text-gray-600">{caso.descripcion}</p>
                    <p className="text-xs text-gray-500">Creado: {caso.fechaCreacion}</p>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span className={`px-2 py-1 text-xs rounded-full ${
                      caso.prioridad === 'alta' ? 'bg-red-100 text-red-800' :
                      caso.prioridad === 'media' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-green-100 text-green-800'
                    }`}>
                      {caso.prioridad}
                    </span>
                    <button
                      onClick={() => {
                        setCasoSeleccionado(caso)
                        setModalGestionarCaso(true)
                        setModalCasosActivos(false)
                      }}
                      className="text-blue-600 hover:text-blue-700"
                    >
                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                      </svg>
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {modalPersonalFormado && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-900">Personal y Formaci√≥n</h3>
              <button
                onClick={() => setModalPersonalFormado(false)}
                className="text-gray-500 hover:text-gray-700"
              >
                ‚úï
              </button>
            </div>
            <div className="space-y-4">
              {personalData.map((persona) => (
                <div key={persona.id} className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div className="flex items-center space-x-3">
                    <div className="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                      <span className="text-sm font-medium text-gray-700">
                        {persona.nombre.split(' ').map(n => n[0]).join('')}
                      </span>
                    </div>
                    <div>
                      <p className="text-sm font-medium text-gray-900">{persona.nombre}</p>
                      <p className="text-xs text-gray-600">{persona.cargo}</p>
                    </div>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span className={`px-2 py-1 text-xs rounded-full ${
                      persona.formado ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                    }`}>
                      {persona.formado ? 'Formado' : 'Pendiente'}
                    </span>
                    {persona.certificado && (
                      <svg className="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                      </svg>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {modalCumplimiento && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold text-gray-900">Detalle de Cumplimiento LOPIVI</h3>
              <button
                onClick={() => setModalCumplimiento(false)}
                className="text-gray-500 hover:text-gray-700"
              >
                ‚úï
              </button>
            </div>
            <div>
              <ul className="space-y-3">
                {calcularCumplimiento().elementos.map((el, idx) => (
                  <li key={idx} className="flex items-center space-x-3">
                    <span className={`w-4 h-4 rounded-full flex items-center justify-center ${
                      el.completado ? 'bg-green-500' : 'bg-gray-300'
                    }`}>
                      {el.completado ? (
                        <svg className="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                        </svg>
                      ) : null}
                    </span>
                    <span className={el.completado ? 'text-gray-900' : 'text-gray-500'}>{el.nombre}</span>
                  </li>
                ))}
              </ul>
              <div className="mt-6 text-center">
                <span className="text-lg font-bold text-green-600">{cumplimiento.porcentaje}%</span> de cumplimiento
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Otros modales como modalGestionarCaso, modalCasoUrgente, modalInstruccionesCaso, modalCertificadosPenales, etc. pueden ser implementados aqu√≠ seg√∫n la l√≥gica original */}
    </div>
  )
}
