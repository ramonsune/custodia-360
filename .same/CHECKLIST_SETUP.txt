
  üìß CHECKLIST DE CONFIGURACI√ìN - Sistema de Emails          ‚ïë
  Tiempo total estimado: 15-20 minutos                        ‚ïë


 PASO 1: Supabase Service Key (2 min) ‚≠ê CR√çTICO             ‚îÇ

[ ] 1. Ir a: https://supabase.com/dashboard/project/gkoyqfusawhnobvkoijc/settings/api
[ ] 2. Copiar "service_role" (secret key)
[ ] 3. Pegar en .env.local ‚Üí SUPABASE_SERVICE_ROLE_KEY=...


 PASO 2: Resend API Key (2 min) ‚≠ê CR√çTICO                    ‚îÇ

[ ] 1. Ir a: https://resend.com/api-keys
[ ] 2. Crear/copiar API key
[ ] 3. Pegar en .env.local ‚Üí RESEND_API_KEY=...


 PASO 3: Verificar Dominio en Resend (5 min) ‚≠ê CR√çTICO      ‚îÇ

[ ] 1. Ir a: https://resend.com/domains
[ ] 2. Add Domain ‚Üí custodia360.es
[ ] 3. Copiar 3 registros DNS (SPF, DKIM, DMARC)
[ ] 4. A√±adir registros en tu proveedor DNS
[ ] 5. Esperar 5-15 min
[ ] 6. Clic en "Verify" en Resend
[ ] 7. Ver ‚úÖ "Verified"


 PASO 4: Migraci√≥n SQL #1 - Plantillas (2 min) ‚≠ê CR√çTICO    ‚îÇ

[ ] 1. Ir a: https://supabase.com/dashboard/project/gkoyqfusawhnobvkoijc/editor
[ ] 2. SQL Editor ‚Üí + New Query
[ ] 3. Abrir: supabase/migrations/20250116_email_templates_expansion.sql
[ ] 4. Copiar TODO el contenido
[ ] 5. Pegar en SQL Editor
[ ] 6. Clic "Run" ‚Üí Ver "Success"


 PASO 5: Migraci√≥n SQL #2 - Cron Config (2 min) ‚≠ê CR√çTICO   ‚îÇ

[ ] 1. SQL Editor ‚Üí + New Query
[ ] 2. Abrir: supabase/migrations/20250116_email_cron_schedules.sql
[ ] 3. Copiar TODO el contenido
[ ] 4. Pegar en SQL Editor
[ ] 5. Clic "Run" ‚Üí Ver "Success"


 PASO 6: Verificar Plantillas Creadas (1 min)                ‚îÇ

[ ] 1. SQL Editor ‚Üí Nueva Query
[ ] 2. Ejecutar: SELECT slug FROM message_templates ORDER BY slug;
[ ] 3. Verificar que aparecen:
    [ ] admin-invoice
    [ ] billing-11m-reminder
    [ ] billing-5m-reminder
    [ ] contact-auto-reply
    [ ] contractor-confirm
    [ ] delegate-supl-welcome
    [ ] delegate-welcome


 PASO 7: Configurar Cron Jobs (3 min) ‚≠ê CR√çTICO             ‚îÇ

[ ] 1. SQL Editor ‚Üí + New Query
[ ] 2. Ver archivo: .same/SETUP_MANUAL.md (PASO 5)
[ ] 3. Copiar las 2 queries de cron.schedule
[ ] 4. Pegar en SQL Editor
[ ] 5. Clic "Run"
[ ] 6. Verificar: SELECT * FROM cron.job;
[ ] 7. Ver 2 jobs: c360_mailer_dispatch_cron y c360_billing_reminders_cron


 PASO 8 (OPCIONAL): Variables Netlify - Solo para producci√≥n ‚îÇ

[ ] 1. Netlify ‚Üí Site settings ‚Üí Environment variables
[ ] 2. A√±adir SUPABASE_SERVICE_ROLE_KEY
[ ] 3. A√±adir RESEND_API_KEY
[ ] 4. A√±adir APP_BASE_URL
[ ] 5. A√±adir NOTIFY_EMAIL_FROM
[ ] 6. Save


 ‚úÖ PRUEBA FINAL: Verificar que funciona                     ‚îÇ

[ ] 1. Abrir terminal en custodia-360
[ ] 2. Ejecutar:
    curl -X POST http://localhost:3000/api/test-email-system \
      -H "Content-Type: application/json" \
      -d '{"template":"contact-auto-reply","toEmail":"TU_EMAIL@example.com","context":{"nombre":"Prueba"}}'
[ ] 3. Ver respuesta: {"success": true, ...}
[ ] 4. Esperar 10 minutos
[ ] 5. Revisar tu email ‚Üí Deber√≠as recibir el email de prueba


 üìä ESTADO FINAL                                              ‚îÇ

[ ] Sistema de emails 100% configurado y operativo
[ ] Pueden enviarse emails desde la aplicaci√≥n
[ ] Cron jobs ejecut√°ndose autom√°ticamente
[ ] Dominio verificado en Resend



- Guarda las claves API en un gestor de contrase√±as
- Los cron ejecutan en UTC (08:00 UTC = 09:00 Madrid)
- El dispatcher ejecuta cada 10 minutos autom√°ticamente
- Revisa logs en Supabase Dashboard ‚Üí Functions si hay problemas

- Gu√≠a detallada: .same/SETUP_MANUAL.md
- Resumen ejecutivo: .same/RESUMEN_EMAIL_SYSTEM.txt
- Documentaci√≥n t√©cnica: .same/email-system-setup.md

